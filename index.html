<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í˜„ì‹¤ì ì¸ ê³µë³µ ìš´ë™ ì—ë„ˆì§€ ê³„ì‚°ê¸°</title>
  <style>
    body { font-family: Arial; background: #f2f5fa; padding: 30px; }
    .container {
      max-width: 900px;
      background: white;
      padding: 20px;
      border: 2px solid #123d6b;
      margin: auto;
    }
    label { margin-right: 10px; display: inline-block; margin-bottom: 10px; }
    input, select { margin-right: 20px; padding: 5px; width: 100px; }
    button {
      background-color: #123d6b;
      color: white;
      padding: 7px 15px;
      border: none;
      cursor: pointer;
    }
    .result { margin-top: 20px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #999;
      text-align: center;
      padding: 6px;
    }
    th {
      background-color: #123d6b;
      color: white;
    }
    tr:nth-child(even) { background-color: #eef2f8; }
    .red { color: red; font-weight: bold; }
    .orange { color: orange; font-weight: bold; }
    .highlight-border {
      border: 3px solid #123d6b !important;
      background-color: lightgreen !important;
    }
    .small { font-size: 0.85em; color: #444; }
    .strong-warning {
      color: #990000;
      font-weight: bold;
      margin-top: 20px;
      padding: 10px;
      border: 2px solid #990000;
      background-color: #ffe0e0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>í˜„ì‹¤ì ì¸ ê³µë³µ ìš´ë™ ì—°ë£Œ ì†Œëª¨ ê³„ì‚°ê¸°</h2>

    <!-- ì²« ì¤„: ì„±ë³„, ë‚˜ì´, í‚¤, ëª¸ë¬´ê²Œ -->
    <div>
      <label>ì„±ë³„
        <select id="gender">
          <option value="male">ë‚¨ì„±</option>
          <option value="female">ì—¬ì„±</option>
        </select>
      </label>
      <label>ë‚˜ì´ <input type="number" id="age"></label>
      <label>í‚¤(cm) <input type="number" id="height"></label>
      <label>ëª¸ë¬´ê²Œ(kg) <input type="number" id="weight"></label>
    </div>

    <!-- ë‘˜ì§¸ ì¤„: ê³µë³µì‹œê°„, ìš´ë™ ìˆ™ë ¨ë„, ë²„íŠ¼ -->
    <div style="margin-top: 10px;">
      <label>ê³µë³µ ì‹œê°„(ì‹œê°„) <input type="number" id="fastingHour" value="8"></label>
      <label>ìš´ë™ ìˆ™ë ¨ë„
        <select id="fitnessLevel">
          <option value="beginner">ì´ˆë³´ì</option>
          <option value="intermediate">ì¤‘ê¸‰ì</option>
          <option value="advanced">ìƒê¸‰ì</option>
        </select>
      </label>
      <button onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
    </div>

    <div class="result" id="resultArea"></div>
  </div>

  <script>
    function pad(g) { return g < 10 ? "0" + g : g; }

    function calculate() {
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value);
      const height_cm = parseFloat(document.getElementById("height").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const fastingHour = parseFloat(document.getElementById("fastingHour").value);
      const fitnessLevel = document.getElementById("fitnessLevel").value;

      if (!age || !height_cm || !weight) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const height_m = height_cm / 100;
      const bmi = weight / (height_m * height_m);

      let bodyFatPercentage = (1.20 * bmi) + (0.23 * age) - (gender === "male" ? 16.2 : 5.4);
      bodyFatPercentage = Math.max(5, Math.min(50, bodyFatPercentage));

      const fatMass = weight * (bodyFatPercentage / 100);
      const leanMass = weight - fatMass;
      const muscleMass = leanMass * 0.5;
      const BMR = gender === "male"
        ? 10 * weight + 6.25 * height_cm - 5 * age + 5
        : 10 * weight + 6.25 * height_cm - 5 * age - 161;

      const initialGlycogenMuscle = muscleMass * 15;
      const initialGlycogenLiver = Math.round(leanMass * 1.2);
      let liverReductionRate = fastingHour >= 16 ? 0.7 : fastingHour >= 12 ? 0.5 : fastingHour >= 8 ? 0.3 : 0;
      const adjustedGlycogenLiver = Math.round(initialGlycogenLiver * (1 - liverReductionRate));

      let ratioAdjustment = fitnessLevel === "intermediate" ? -0.05 : fitnessLevel === "advanced" ? -0.1 : 0;

      const activities = [
        { name: "ê±·ê¸°", MET: 3.5, ratioCurve: [0.4,0.35,0.3,0.25,0.22,0.2,0.18,0.16,0.15,0.14,0.13,0.12,0.11,0.1,0.1,0.1,0.1,0.1,0.1,0.1] },
        { name: "ë¹¨ë¦¬ê±·ê¸°", MET: 5.0, ratioCurve: [0.5,0.45,0.4,0.35,0.3,0.25,0.2,0.15,0.15,0.15,0.15,0.15,0.15,0.15,0.15,0.15,0.15,0.15,0.15,0.15] },
        { name: "ìŠ¬ë¡œìš°ì¡°ê¹…", MET: 6.0, ratioCurve: [0.5,0.45,0.4,0.35,0.3,0.25,0.2,0.15,0.15,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1] },
        { name: "ë“±ì‚°", MET: 9.0, ratioCurve: [0.4,0.35,0.3,0.25,0.2,0.15,0.12,0.1,0.08,0.06,0.05,0.04,0.035,0.03,0.025,0.02,0.015,0.01,0.007,0.005] }
      ];

      const times = Array.from({length: 20}, (_, i) => (i + 1) * 0.5);
      let table = `<table><tr><th>ì‹œê°„</th>${activities.map(a => `<th>${a.name}</th>`).join("")}</tr>`;

      const cumulative = {};
      activities.forEach(a => cumulative[a.name] = { muscle: 0, liver: 0, fat: 0 });

      times.forEach((t, i) => {
        table += `<tr><td>${t * 60}ë¶„</td>`;
        activities.forEach(a => {
          const dt = 0.5;
          const kcal = a.MET * weight * dt;
          const r = Math.max(0, Math.min(1, a.ratioCurve[Math.min(i, a.ratioCurve.length - 1)] + ratioAdjustment));
          const gG = (kcal * r) / 4;
          const fG = (kcal * (1 - r)) / 9;
          const mG = gG * 0.8;
          const lG = gG * 0.2 + 0.3 * dt;

          cumulative[a.name].muscle += mG;
          cumulative[a.name].liver += lG;
          cumulative[a.name].fat += fG;

          const rm = initialGlycogenMuscle - cumulative[a.name].muscle;
          const rl = adjustedGlycogenLiver - cumulative[a.name].liver;

          let cls = "";
          if (rl < 10 || rm < 40) cls = "red";
          else if (rl <= 25 && rl > 20) cls = "highlight-border";
          else if (rl < 20 || rm < 80) cls = "orange";

          let risk = (a.name === "ê±·ê¸°" && t >= 4) ? '<br><span class="orange small">âš ï¸ ì¥ì‹œê°„ ê±·ê¸°: ìˆ˜ë¶„/ì—ë„ˆì§€ ë³´ì¶© í•„ìš”</span>' : "";
          table += `<td class="${cls}">M:${pad(Math.round(cumulative[a.name].muscle))}g / L:${pad(Math.round(rl))}g / F:${pad(Math.round(cumulative[a.name].fat))}g<br><span class='small'>ğŸ”¥ ${Math.round(a.MET * weight * t)} kcal</span>${risk}</td>`;
        });
        table += `</tr>`;
      });
      table += `</table>`;

      document.getElementById("resultArea").innerHTML = `
        <p><strong>ê¸°ì´ˆëŒ€ì‚¬ëŸ‰:</strong> ${Math.round(BMR)} kcal</p>
        <p><strong>ì²´ì§€ë°©ë¥ :</strong> ${bodyFatPercentage.toFixed(1)}% | <strong>ê·¼ìœ¡ëŸ‰:</strong> ${muscleMass.toFixed(1)}kg</p>
        <p><strong>ê°„ ê¸€ë¦¬ì½”ê²:</strong> ${adjustedGlycogenLiver}g | <strong>ê·¼ìœ¡ ê¸€ë¦¬ì½”ê²:</strong> ${initialGlycogenMuscle.toFixed(0)}g</p>
        <h4>ìš´ë™ ì‹œ ì—ë„ˆì§€ ì‚¬ìš©</h4>${table}
        <p class="orange">ğŸŸ  ê°„ ê¸€ë¦¬ì½”ê² < 20g ë˜ëŠ” ê·¼ìœ¡ < 80g: í”¼ë¡œ ëˆ„ì </p>
        <p class="red">ğŸ”´ ê°„ ê¸€ë¦¬ì½”ê² < 10g ë˜ëŠ” ê·¼ìœ¡ < 40g: ì €í˜ˆë‹¹/ê·¼ì†ì‹¤ ìœ„í—˜</p>
        <p class="strong-warning">âš ï¸ ì¥ì‹œê°„ ìš´ë™ ì‹œ ë¬¼, íƒ„ìˆ˜í™”ë¬¼ ë³´ì¶©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤. ìˆ˜ì¹˜ê°€ ì•ˆì „í•´ ë³´ì—¬ë„ ì‹¤ì œ ì¸ì²´ëŠ” ë” ë³µì¡í•˜ê²Œ ë°˜ì‘í•©ë‹ˆë‹¤.</p>
      `;
    }
  </script>
</body>
</html>
